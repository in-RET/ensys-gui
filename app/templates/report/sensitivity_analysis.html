{% extends 'scenario/scenario_results_page.html' %}
{% load static %}
{% load custom_filters %}
{% load custom_template_tags %}
{% load i18n %}


{% block title %}{% translate "Sensitivity analysis" %}{% endblock title %}


{% block dashboard %}

    <section class="dashboard">
        <div>
            <div class="row">
                <div class="dashboard__scenarios">
                    <h2>My sensitivity analysis</h2>
                    <div class="scenario-select">
                        {% for sa in sa_list %}
                        {% if sa.id|stringformat:'s' in request|get_selected_scenarios:proj_id %}
                            {% setvar "selected" as selected %}
                        {% else%}
                            {% setvar "" as selected %}
                        {% endif %}
                            <button id="sa-{{ proj_id }}-{{ sa.id}}" class="scenario-select__item {{ selected }}" onclick="update_selected_sa(this)">
                                {{ sa.name }}
                            </button>
                        {% empty %}
                            {% translate "You have no sensitivity analysis with completed simulation, please run simulations to display results" %}
                        {% endfor %}


                    </div>
                </div>
            </div>
            {% if sa_list %}
            <div class="row dashboard__create">
                <div class="col">
                  <button class="btn btn--medium" onclick="javascript:showCreateSaGraphModal(event)">
                    <span class="icon icon-add"></span>
                    Create graph
                  </button>
                </div>
            </div>
            <div> HERE WILL BE THE SENSITIVITY ANALYSIS SPECIFIC GRAPHS DISPLAYED</div>
            <div class="row">
                <div class="col" id="report_items">
                </div>
            </div>
            {# TODO: make button or add kpi/scalar matrix results to downloadable excel sheet #}
            {% if scen_id %}
                <a type="button" class="btn btn-info" href="{% url 'download_timeseries_results' scen_id %}">{% translate "Download Timeseries" %}</a>
            {% endif %}
            {% endif %}
        </div>
    </section>

{% endblock dashboard %}


{% block results_end_body_scripts %}
<script>

document.getElementById('sensitivity-analysis-link').classList.add('active');



    /** Add a new sensitivity graph **/

    const createSaGraphModalDOM = document.getElementById("createSaGraphModal");
    const createSaGraphModal = new bootstrap.Modal(createSaGraphModalDOM);

    function showCreateSaGraphModal(event){
        createSaGraphModal.show()
    }


 $("#id_analysis").change(function () {
      var saId= $(this).val();  // get the selected country ID from the HTML input

      $.ajax({                       // initialize an AJAX request
        headers: {'X-CSRFToken': `{{ csrf_token }}` },
        type: "POST",
        url: urlSaForm,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
        data: {
          'sa_id': saId       // add the country id to the GET parameters
        },
        success: function (data) {   // `data` is the return of the `load_cities` view function
          console.log(data)
          $("#id_y").html(data);  // replace the contents of the city input with the data that came from the server
        }
      });
  });


</script>
{% endblock results_end_body_scripts %}